{"version":3,"file":"common.js","sourceRoot":"","sources":["../../src/setup/common.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,wDAA0B;AAE1B,uDAAmC;AACnC,uDAAmC;AACnC,oDAA0C;AAC1C,+EAAgE;AAEjD,KAAK,UAAU,WAAW;IACvC,sBAAsB,EAAE,CAAC;IACzB,MAAM,OAAO,CAAC,IAAI,EAAE,CAAC;IACrB,MAAM,kBAAE,CAAC,MAAM,CAAC,gBAAM,CAAC,WAAW,CAAC,kBAAkB,CAAC,CAAC;IACvD,MAAM,kBAAE,CAAC,MAAM,CAAC,gBAAM,CAAC,WAAW,CAAC,aAAa,CAAC,CAAC;AACpD,CAAC;AALD,8BAKC;AAED,KAAK,UAAU,sBAAsB;IACnC,IAAI;QACF,MAAM,wBAAmB,EAAE,CAAC;KAC7B;IAAC,OAAO,GAAG,EAAE;QACZ,gBAAM,CAAC,KAAK,CAAC,EAAE,GAAG,EAAE,EAAE,mCAAmC,CAAC,CAAC;KAC5D;YAAS;QACR,UAAU,CAAC,sBAAsB,EAAE,gBAAM,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;KAC/D;AACH,CAAC","sourcesContent":["import fs from 'fs-extra';\n\nimport config from 'turtle/config';\nimport logger from 'turtle/logger';\nimport * as metrics from 'turtle/metrics';\nimport sendConfigToDatadog from 'turtle/metrics/buildersConfig';\n\nexport default async function commonSetup() {\n  announceBuildersConfig();\n  await metrics.init();\n  await fs.remove(config.directories.temporaryFilesRoot);\n  await fs.remove(config.directories.tempS3LogsDir);\n}\n\nasync function announceBuildersConfig() {\n  try {\n    await sendConfigToDatadog();\n  } catch (err) {\n    logger.error({ err }, 'Failed to send metrics to Datadog');\n  } finally {\n    setTimeout(announceBuildersConfig, config.datadog.intervalMs);\n  }\n}\n"]}